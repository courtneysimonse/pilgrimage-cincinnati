<!DOCTYPE html>
<html>

<head>
  <meta charset=utf-8 />
  <title>Cincinnati Pilgrimage Trails</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <link href='https://api.mapbox.com/mapbox-assembly/v0.20.0/assembly.min.css' rel='stylesheet'>
  <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
  <link href='https://fonts.googleapis.com/css?family=Work+Sans:400,500,600' rel='stylesheet' type='text/css'>
  <link href='css/styles.css' rel='stylesheet' />

  <style>

  </style>
</head>

<body>
  <div class='flex-parent viewport-full relative scroll-hidden'>
    <div class='flex-child w-full w300-ml absolute static-ml left bottom'>
      <div class='flex-parent flex-parent--column viewport-third h-full-ml hmax-full bg-white py18 px12'>
        <div class='flex-child flex-child--grow px12 py12 scroll-auto'>
          <h1 class='txt-h1 mb6'>Archdiocese of Cincinnati Pilgrimage Trails</h1>
          <a href='#' id='geolocate' class='ui-button'>Find me</a>
          <!-- <p></p> -->
          <div id='description'></div>
          <div id='directions'></div>
        </div>
        <footer class='px12 py12 bg-gray-faint txt-s'>
          <ul>
            <li>Learn more about the
              <a class='link' target="_blank" href='https://www.pilgrimageoffaith.org/'>Pilgrimage of Faith.</a>
              These trails were developed for the Archdiocese of Cincinnati's Catholic Committee of Scouting.
            </li>
            <li>Map authored by
              <a class='link' target="_blank" href='https://courtneysimonse.github.io/'>Courtney Simonse</a>
            </li>
          </ul>
        </footer>
      </div>
    </div>
    <div class='flex-child flex-child--grow viewport-twothirds viewport-full-ml'>
      <div id="map" class='viewport-twothirds viewport-full-ml'></div>
    </div>
  </div>

  <!-- ui info panel -->
  <div id='info' class='py6 px12 bg-white border border--gray-light round absolute w240'>
    <p>Name:
      <span></span>
    </p>
  </div>

  <!-- ui controls for layer selection -->
  <div id='ui-controls'>
  		<!-- <label>Choose a trail:</label> -->
  	  <select id="trails">
  	    <!-- <option value="Cathedral Trail 5 mi" selected>Cathedral Trail - 5 mi</option> -->
  	    <!-- <option value=""></option>
  	    <option value=""></option>
  			<option value=""></option>
  			<option value=""></option>
  			<option value=""></option> -->
  	  </select>
  </div> <!-- end ui-controls -->


  <script async defer src="https://api.mapbox.com/mapbox-assembly/v0.20.0/assembly.js"></script>
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.5/chroma.min.js"></script>
  <script src="data/trails.js"></script>

  <script>

    var options = {
      zoomSnap: .1,
      center: [39.2, -84.5],
      zoom: 11,
      minZoom: 6,
      maxZoom: 15
    }

    var map = L.map('map', options);

    // request tiles and add to map
    var Stamen_Terrain = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.{ext}', {
      attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      subdomains: 'abcd',
      minZoom: 0,
      maxZoom: 18,
      ext: 'png'
    }).addTo(map);

    // trail names
    var layerInfo = {
      cathedralShort: {name:"Cathedral Trail 5 mi"},
      cathedralLong: {name:"Cathedral Trail 11.4 mi"},
      eastSideEast: {name:"East Side Trail - East Route"},
      westSideSouth: {name:"West Side Trail - South Loop"},
      westSideNorth: {name:"West Side Trail - North Loop"},
      central: {name:"Central Trail"},
      north: {name:"North Trail"},
      eastSideWest1: {name:"East Side Trail - West Route Option 1"},
      eastSideWest2: {name:"East Side Trail - West Route Option 2"}
    };
    console.log(layerInfo['cathedralLong']['name']);

    var dropdownList = '';

    for (var layer in layerInfo) {
      dropdownList += '<option value="' + layerInfo[layer]['name'] +'">' + layerInfo[layer]['name'] + '</option>'
    }
    console.log(dropdownList);
    $("#trails").html(dropdownList)

    var selectedTrail = document.getElementById('trails').value;
    console.log(selectedTrail);

    // icon for churches
    var churchIcon = L.icon({
      iconUrl: "images/church.svg",
      iconSize: [15,15],
    })

    // add church points
    // use JQuery to import XML data
    $(document).ready(function() {
      $.ajax({
        type: "GET",
        url: "data/parish-locations.xml",
        dataType: "xml",
        success: parseXML
      });
    });

    var churchLayer = new L.layerGroup();

    // add church data from XML file
    function parseXML(xml) {
      $(xml).find("marker").each(function() {
        churchPoint = L.marker([$(this).attr("lat"), $(this).attr("lng")], {
          icon: churchIcon
        }).bindPopup($(this).attr("name"))
          .addTo(churchLayer);
      });
    }
    churchLayer.addTo(map);

    // trailsLayers = {};

    // add route data to map
    $.getJSON("data/trails.geojson", function(trails) {
      // for (var layer in layerInfo) {
      //   trailsLayers[layer] = L.geoJson(data, {
      //     filter: function(feature) {
      //       if (feature.properties.name == layerInfo[layer]["name"]) {
      //         return feature;
      //       }
      //     },
      //     style: function(feature) {
      //       return {dashArray: [5,5]};
      //     }
      //   }).addTo(map);
      // }
      drawMap(trails);
    });

    // console.log(trailsLayers);

    // addUi(trailsLayers, layerInfo)

    function drawMap(trails) {
      var dataLayer = L.geoJson(trails, {
        style: function(feature) {
          return {
            color: 'black',
            weight: 1,
            dashArray: [5,5]
          };
        },
        onEachFeature: function(feature, layer) {
          // when mousing over a layer
          layer.on('mouseover', function() {

            // change the stroke color and bring that element to the front
            layer.setStyle({
              color: 'yellow',
              // weight: 1
            })//.bringToFront();
          });

          // on mousing off layer
          layer.on('mouseout', function() {

            // reset the layer style to its original stroke color
            layer.setStyle({
              color: 'black',
              // weight: .5
            });
          });
        }
      }).addTo(map);

      updateMap(dataLayer, 'Cathedral Trail 5 mi');
      addUi(dataLayer);

    } // end drawMap

    function addUi(dataLayer,) {
      // create the dropdown
      var selectControl = L.control({ position: 'topright' });
      // when control is added
      selectControl.onAdd = function(map) {
        // get the element with id attribute of ui-controls
        return L.DomUtil.get("ui-controls");
      }
      // add the control to the map
      selectControl.addTo(map);

      $('select[id="trails"]')
        .change(function() {
        // code executed here when change event occurs
        selectedTrail = this.value;
        console.log(selectedTrail);
        // call updateMap function
        updateMap(dataLayer, selectedTrail);
      });
    } // end addUi

    function updateMap(dataLayer, selectedTrail) {
      console.log(dataLayer.getLayers());
      dataLayer.removeFrom(map);
      dataLayer.eachLayer(function(layer) {
        // console.log(layer);
        if (layer.feature.properties["name"] == selectedTrail) {
          console.log(layer);
          return layer;
        } else {
          layer.remove();
        }
      }).addTo(map);
      // for (var layer in layerInfo) {
      //   console.log(dataLayer[layer]);
      //   L.geoJson(dataLayer[layer], {
      //     filter: function(feature) {
      //       if (feature.properties.name == selectedTrail) {
      //         return feature;
      //       }
      //     }
      //   }).addTo(map);
      // }
    } // end updateMap

  </script>

  </body>

  </html>
